var current_question,sess_token,money_level=1,button_lock=!1,usedHelps=[];function shuffle(e){e.sort(()=>Math.random()-.5)}const sleep=e=>new Promise(t=>setTimeout(t,e));function decode(e){var t=document.createElement("div");return t.innerHTML=e,void 0!==t.textContent?t.textContent:t.innerText}function getRandomInt(e){return Math.floor(Math.random()*Math.floor(e))}function getSessToken(){fetch("https://opentdb.com/api_token.php?command=request",{method:"get"}).then(function(e){return e.json()}).then(function(e){sess_token=e.token,document.getElementById("menu").style.visibility="visible",document.getElementById("loading-div").style.visibility="hidden"}).catch(function(e){console.log(e)})}function getQuestion(e){fetch("https://opentdb.com/api.php?amount=1&difficulty="+e+"&type=multiple&token="+sess_token,{method:"get"}).then(function(e){return e.json()}).then(function(e){if(0!=e.response_code){if(3!=e.response_code&&4!=e.response_code)return;getSessToken(),sleep(1e3).then(()=>{})}current_question=e.results[0],document.getElementById("question").textContent=decode(current_question.question);var t=current_question.incorrect_answers;t.push(current_question.correct_answer),shuffle(t),Array.from(document.getElementsByClassName("answer-item")).forEach(function(e){e.style.background="cyan",e.style.visibility="visible"}),Array.from(document.getElementsByClassName("answer")).forEach(function(e,n){e.textContent=decode(t[n])}),document.getElementById("status").style.visibility="hidden",button_lock=!1}).catch(function(e){console.log(e)})}function hideAnswers(){Array.from(document.getElementsByClassName("answer-item")).forEach(function(e){e.style.visibility="hidden"})}function startGame(){$("#start-button","#menu").click(function(){null!=sess_token&&(button_lock=!0,document.getElementById("question-answer-container").style.visibility="visible",document.getElementById("stats").style.visibility="visible",document.getElementById("menu").style.visibility="hidden",document.getElementById("reset-button").style.visibility="visible",getQuestion("easy"))})}function resetGame(){$("#reset-button","#main").click(function(){if(!button_lock){document.getElementById("question-answer-container").style.visibility="hidden",hideAnswers(),document.getElementById("stats").style.visibility="hidden",document.getElementById("menu").style.visibility="visible",document.getElementById("reset-button").style.visibility="hidden",document.getElementById("status").style.visibility="hidden",document.getElementById("question").textContent="Loading...",Array.from(document.getElementsByClassName("help-item")).forEach(function(e){e.style.background="#ffd6a1"});var e=document.getElementById("audience-help");"Ask Audience"!=e.textContent&&(e.textContent="Ask Audience");var t=document.getElementById("friend-help");"Call a Friend"!=t.textContent&&(t.textContent="Call a Friend"),Array.from(document.getElementsByClassName("money-level-item")).forEach(function(e){"1"==e.firstChild.textContent?e.id="current-level":"current-level"==e.id&&(e.id="")}),money_level=1,button_lock=!1,usedHelps=[]}})}function pickAnswer(){$(".answer-item","#answers").click(function(){if(!button_lock){button_lock=!0;var e=$(this).find(".answer")[0];$(this)[0].style.background="yellow",sleep(2e3).then(()=>{e.textContent==decode(current_question.correct_answer)?($(this)[0].style.background="lightgreen",sleep(2e3).then(()=>{var e=$("#current-level","#money-levels-container");if("15"!=e.find(".level")[0].textContent){e.removeAttr("id"),e.prev().attr("id","current-level");var t=document.getElementById("audience-help");"Ask Audience"!=t.textContent&&(t.textContent="Ask Audience");var n=document.getElementById("friend-help");"Call a Friend"!=n.textContent&&(n.textContent="Call a Friend")}else{document.getElementById("question-answer-container").style.visibility="hidden",hideAnswers();var i=document.getElementById("status");i.textContent="Congratulations! You've won 1 MILLION!",i.style.background="lightgreen",i.style.visibility="visible"}e.find(".level")[0].textContent>10?getQuestion("hard"):e.find(".level")[0].textContent>5?getQuestion("medium"):getQuestion("easy")})):($(this)[0].style.background="red",Array.from(document.getElementsByClassName("answer")).forEach(function(e){e.textContent!=decode(current_question.correct_answer)||(e.parentNode.style.background="lightgreen")}),sleep(2e3).then(()=>{hideAnswers(),document.getElementById("question-answer-container").style.visibility="hidden";var e=document.getElementById("status");e.textContent="Sorry, you've failed!",e.style.background="red",e.style.visibility="visible",button_lock=!1}))})}})}function getRandomAnswer(){var e=[];return Array.from(document.getElementsByClassName("answer")).forEach(function(t){"hidden"!=t.parentElement.style.visibility&&e.push(t.previousElementSibling)}),shuffle(e),e[0].textContent}function pickHelp(){$(".help-item","#helps-container").click(function(){if(!button_lock&&"visible"!=document.getElementById("status").style.visibility){var e=$(this),t=e.attr("id");if(null==usedHelps.find(function(e){return t==e})){if("friend-help"==t)e.text("Correct answer is "+getRandomAnswer());else if("50/50-help"==t){var n,o,s=getRandomInt(4);for(Array.from(document.getElementsByClassName("answer")).forEach(function(e,t){e.textContent==decode(current_question.correct_answer)&&(n=t)}),i=0;i<2;i++){for(;s==n||s==o;)s=getRandomInt(4);o=s,document.getElementsByClassName("answer-item")[s].style.visibility="hidden"}}else if("audience-help"==t){Math.random()<.7?Array.from(document.getElementsByClassName("answer")).forEach(function(t){t.textContent==decode(current_question.correct_answer)&&"hidden"!=t.parentElement.style.visibility&&e.text("Correct answer is "+t.previousElementSibling.textContent)}):e.text("Correct answer is "+getRandomAnswer())}usedHelps.push(t),$(this).css("background-color","lightgray")}}})}window.onload=function(){sessToken=getSessToken(),startGame(),resetGame(),pickAnswer(),pickHelp()};